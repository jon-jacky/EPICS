vdb.py
======

**vdb.py** generates a data flow graph from an EPICS database.  

How it works
------------

**vdb.py** uses *parseDb* in
[epicsUtils](http://www-csr.bessy.de/control/bii_scripts/html/python/epicsUtils.html)
(download
[here](http://www-csr.bessy.de/control/bii_scripts/repo/bii_scripts/lib/python/epicsUtils.py))
from [BESSY](http://www-csr.bessy.de/) to load an EPICS database file
into a list of dictionaries, one dictionary per EPICS record, where
the dictionary keys are the field names (with one additional key,
*recordname*).  Then *vdb.py* generates a script in the *dot* graph
language where each node is an EPICS record and each edge is a link:
INP, OUT, FLNK, etc.  The edges are labelled so that they indicate
control flow as well as data flow.

**vdb.py** sends the *dot* graph script to standard output.  We
usually redirect it to a *.dot* file.  Then our *dotsvg* script uses
the *dot* graph layout program from the
[Graphviz](http://www.graphviz.org/) package to generate an *.svg*
graphics file, which can be viewed in a browser.  The layout
generated by *dot* usually makes the data flow and
control flow clear.


Input files
----------

The input files for *vdp.py* are EPICS database files.  Many examples
are in the *.vdb* files in the [db](../db) directory.

Most of the *.db* files from our EPICS CNTS program cannot be used as
input to *vdb.py*.  They require some manual pre-processing with shell
commands and a text editor to produce our *.vdb files (see below).

Our *.vdb* files in this repository are not in the same format as the
*.vdb* files used with the EPICS *vdct* program (because *.vdb* files
for *vdct* include graphics layout information).  The similarity in
names is a (confusing) coincidence.


Output files
-----------

The output files from *vdp.py* are *.dot* files.  

The *.dot* files are inputs to our *dotsvg* script.  The outputs from
*dotsvg* are *.svg* files that can be displayed in a browser to show
the data flow diagrams.

Many examples of *.dot* and *.svg* files are in the [db](../db)
directory.


Commands
--------

*vdb.py dosimetry.db > dosimetry.dot* processes *dosimetry.db* to produce *dosimetry.dot*

*dotsvg dosimetry* processes *dosimetry.dot* to produce *dosimetry.svg*.

*vdb.py* is in the [bin](../bin) directory.

Many *.sh* scripts in the [bin](../bin) directory contain examples of
these commands.  These scripts are intended to be run from the
[db](../db) directory, by commands such as: *./bin/dosimetry_vdb.sh*.

The *.sh* scripts define *PATH* and *PYTHONPATH* as needed at the
author's site, so they will not work anywhere else.


Preprocessing the input data
----------------------------

(to come)


Revised December 2014

